<h1>PO auto translator (with help of <a id="branding" href="http://code.google.com/intl/en/apis/ajaxlanguage/documentation/"></a>)</h1>
<h2>Source/destination languages</h2>
<input id="sourceLanguage" value="en"/>
<input id="destinationLanguage" value="ru"/>
<h2>Source/destination texts</h2>
<textarea id="sourceText">
#: app/app_controller.php:82
msgid "Home page"
msgstr "My cool home page!"

#: app/controllers/contact_people_controller.php:67
msgid "Data is empty. Please try again."
msgstr ""

#: app/app_controller.php:82
msgid "Home page"
msgstr "My cool home page!"

#: app/controllers/contact_people_controller.php:67
msgid "Data is empty. Please try again."
msgstr ""
</textarea>
<textarea id="destinationText"></textarea>
<button id="doWork">Just work!</button>

<style>
#branding {
    display:    inline-block;
}
input, textarea {
    width:      49%;
}
textarea {
    height:     50%;
}
button {
    width:      100%;
    height:     50px;
    font-size:  32px;
}
</style>

<script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAEc0DAsABBU-ZkNYvNdG37hTULOI0PHO8DIaggRyBMDL-OJEw-hQzPCpdXEaKgKqoaQfLkKZg0Y1MJA"></script>
<script type="text/javascript">
google.load('language', '1', {callback: function () {
    google.language.getBranding('branding');
}});

var garex = {};
garex.$ = function (id) {
    return document.getElementById(id);
}

garex.translate = function (text, fn) {
    google.language.translate(
        text, garex.$('sourceLanguage').value, garex.$('destinationLanguage').value,
        function(result) {
            if (!result.error) {
                fn(result.translation);
            }
    });
}

garex.guessEOL = function (text) {
    var win = '\r\n';
    var mac = '\r';
    var nix = '\n';
    if (-1 != text.search(win)) {
        return win;
    }
    if (-1 != text.search(mac)) {
        return mac;
    }
    if (-1 != text.search(nix)) {
        return nix;
    }
    return win;
}

garex.$('doWork').onclick = function () {
    // Copy text
    var text    = garex.$('sourceText').value;
    var EOL     = garex.guessEOL(text);
    
    // Auto-fill empty msgstrs
    var strings = text.split(EOL);
    for (var i = 0; i < strings.length; i++) {
        if ('msgstr ""' == strings[i] && i > 0) {
            strings[i] = strings[i-1] . replace(/^msgid "/, 'msgstr "');
        }
    }
    
    // Translate & update
    var fns = [];
    for (var i = 0; i < strings.length; i++) {
        var match = strings[i].match(/^msgstr\s+"(.+)"$/);
        if (!match) {
            continue;
        }
        garex.translate(
            match[1],
            (function () {
                var counter = i;
                return function (translatedText) {
                    // Replace & set text
                    strings[counter] = 'msgstr "' + translatedText + '"';
                    garex.$('destinationText').value = strings.join(EOL);
                }
            })()
        );
    }
}
</script>